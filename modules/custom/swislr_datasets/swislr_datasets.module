<?php

use Drupal\Core\Form\FormStateInterface;

/**
 * Hide Location when Spatial extent is Global or Continental.
 */
function swislr_datasets_form_node_dataset_form_alter(array &$form, FormStateInterface $form_state, $form_id) {
  \Drupal::logger('swislr_datasets')->notice('form alter fired');

  $selector = ':input[name="field_spatial_extent"]';

  if (isset($form['field_location'])) {
    // Base required state when visible.
    if (!isset($form['field_location']['#required'])) {
      $form['field_location']['#required'] = TRUE;
    }

    $form['field_location']['#states'] = [
      // Hide when value is 'global' OR 'continental'.
      'invisible' => [
        [ $selector => ['value' => 'global'] ],
        'or',
        [ $selector => ['value' => 'continental'] ],
      ],
      // Required mirrors visibility: required when not invisible.
      'required' => [
        [ $selector => ['!value' => 'global'] ],
        [ $selector => ['!value' => 'continental'] ],
      ],
    ];
  }
}

